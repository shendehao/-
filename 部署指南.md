# åº“å­˜ç®¡ç†ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ–¹å¼

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š
1. **Dockeréƒ¨ç½²**ï¼ˆæ¨èï¼‰- ä¸€é”®éƒ¨ç½²æ‰€æœ‰æœåŠ¡
2. **ä¼ ç»Ÿéƒ¨ç½²** - æ‰‹åŠ¨é…ç½®ç¯å¢ƒ

---

## ğŸ³ æ–¹å¼ä¸€ï¼šDockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

### å‰ç½®è¦æ±‚

- Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- Docker Compose å·²å®‰è£…

### å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

#### 1. å‡†å¤‡ç¯å¢ƒå˜é‡æ–‡ä»¶

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š

```bash
# Djangoé…ç½®
SECRET_KEY=your-secret-key-here-change-in-production
DEBUG=False
ALLOWED_HOSTS=localhost,127.0.0.1,your-domain.com

# æ•°æ®åº“é…ç½®ï¼ˆDockerä¼šè‡ªåŠ¨ä½¿ç”¨PostgreSQLï¼‰
DB_ENGINE=django.db.backends.postgresql
DB_NAME=inventory_db
DB_USER=postgres
DB_PASSWORD=postgres123
DB_HOST=db
DB_PORT=5432

# Redisé…ç½®
REDIS_URL=redis://redis:6379/0

# æ–‡ä»¶ä¸Šä¼ 
MEDIA_URL=/media/
MEDIA_ROOT=media/
```

#### 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åªæŸ¥çœ‹webæœåŠ¡æ—¥å¿—
docker-compose logs -f web
```

#### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿›å…¥webå®¹å™¨
docker-compose exec web bash

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
python manage.py migrate

# åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser

# ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
python setup_database.py

# é€€å‡ºå®¹å™¨
exit
```

#### 4. è®¿é—®æœåŠ¡

- **å‰ç«¯ç•Œé¢**: http://localhost/
- **APIæ–‡æ¡£**: http://localhost/swagger/
- **ç®¡ç†åå°**: http://localhost/admin/

### Dockerå‘½ä»¤å‚è€ƒ

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f web

# è¿›å…¥å®¹å™¨
docker-compose exec web bash

# æ‰§è¡Œå‘½ä»¤
docker-compose exec web python manage.py migrate

# åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æ•°æ®åº“ï¼‰
docker-compose down -v
```

---

## ğŸ–¥ï¸ æ–¹å¼äºŒï¼šä¼ ç»Ÿéƒ¨ç½²

### å‰ç½®è¦æ±‚

- Python 3.11+
- PostgreSQL 15+ æˆ– SQLiteï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- Redis 7+ï¼ˆå¯é€‰ï¼‰
- Nginxï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### éƒ¨ç½²æ­¥éª¤

#### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

#### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
SECRET_KEY=your-secret-key-here
DEBUG=False
ALLOWED_HOSTS=your-domain.com,www.your-domain.com

# PostgreSQLé…ç½®
DB_ENGINE=django.db.backends.postgresql
DB_NAME=inventory_db
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_HOST=localhost
DB_PORT=5432

# Redisé…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_URL=redis://localhost:6379/0
```

#### 4. æ•°æ®åº“è¿ç§»

```bash
python manage.py makemigrations
python manage.py migrate
```

#### 5. åˆ›å»ºè¶…çº§ç”¨æˆ·

```bash
python manage.py createsuperuser
```

#### 6. æ”¶é›†é™æ€æ–‡ä»¶

```bash
python manage.py collectstatic --noinput
```

#### 7. ä½¿ç”¨Gunicornå¯åŠ¨

```bash
# å¼€å‘ç¯å¢ƒ
gunicorn config.wsgi:application --bind 0.0.0.0:8000

# ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èé…ç½®ï¼‰
gunicorn config.wsgi:application \
    --bind 0.0.0.0:8000 \
    --workers 3 \
    --threads 2 \
    --timeout 120 \
    --access-logfile - \
    --error-logfile -
```

#### 8. é…ç½®Nginxï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

åˆ›å»º `/etc/nginx/sites-available/inventory`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    client_max_body_size 10M;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static/ {
        alias /path/to/your/project/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location /media/ {
        alias /path/to/your/project/media/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/inventory /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®

### 1. ä¿®æ”¹settings.py

```python
# å…³é—­è°ƒè¯•æ¨¡å¼
DEBUG = False

# è®¾ç½®å…è®¸çš„ä¸»æœº
ALLOWED_HOSTS = ['your-domain.com', 'www.your-domain.com']

# å®‰å…¨è®¾ç½®
SECURE_SSL_REDIRECT = True  # å¼ºåˆ¶HTTPS
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
X_FRAME_OPTIONS = 'DENY'
```

### 2. ç”Ÿæˆæ–°çš„SECRET_KEY

```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

å°†ç”Ÿæˆçš„å¯†é’¥æ·»åŠ åˆ° `.env` æ–‡ä»¶ã€‚

### 3. é…ç½®HTTPS

ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦ï¼š

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. Gunicorné…ç½®

åˆ›å»º `gunicorn_config.py`ï¼š

```python
bind = "0.0.0.0:8000"
workers = 3
threads = 2
timeout = 120
keepalive = 5
max_requests = 1000
max_requests_jitter = 100
```

å¯åŠ¨ï¼š

```bash
gunicorn config.wsgi:application -c gunicorn_config.py
```

### 2. ä½¿ç”¨Redisç¼“å­˜

åœ¨ `settings.py` ä¸­é…ç½®ï¼š

```python
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': config('REDIS_URL', default='redis://127.0.0.1:6379/0'),
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}
```

### 3. æ•°æ®åº“ä¼˜åŒ–

- æ·»åŠ æ•°æ®åº“ç´¢å¼•
- ä½¿ç”¨è¿æ¥æ± 
- å®šæœŸæ¸…ç†æ—¥å¿—

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### Dockeræ–¹å¼

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# é‡å¯æœåŠ¡
docker-compose up -d

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec web python manage.py migrate
```

### ä¼ ç»Ÿæ–¹å¼

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ›´æ–°ä¾èµ–
pip install -r requirements.txt

# æ•°æ®åº“è¿ç§»
python manage.py migrate

# æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic --noinput

# é‡å¯Gunicorn
sudo systemctl restart gunicorn
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰

- [ ] å¤‡ä»½æ•°æ®åº“
- [ ] æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- [ ] ç¡®è®¤SECRET_KEYå·²æ›´æ”¹
- [ ] ç¡®è®¤DEBUG=False
- [ ] ç¡®è®¤ALLOWED_HOSTSå·²è®¾ç½®
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥
- [ ] æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬

### éƒ¨ç½²å

- [ ] æµ‹è¯•ç½‘ç«™è®¿é—®
- [ ] æµ‹è¯•APIæ¥å£
- [ ] æµ‹è¯•ç™»å½•åŠŸèƒ½
- [ ] æ£€æŸ¥é™æ€æ–‡ä»¶åŠ è½½
- [ ] æ£€æŸ¥åª’ä½“æ–‡ä»¶ä¸Šä¼ 
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- [ ] ç›‘æ§æœåŠ¡å™¨èµ„æº

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: `django.db.utils.OperationalError: could not connect to server`

**è§£å†³**:
- æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥æ•°æ®åº“é…ç½®ä¿¡æ¯
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æƒé™

### 2. é™æ€æ–‡ä»¶404

**é—®é¢˜**: CSS/JSæ–‡ä»¶æ— æ³•åŠ è½½

**è§£å†³**:
```bash
# é‡æ–°æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic --noinput

# æ£€æŸ¥STATIC_ROOTè®¾ç½®
# æ£€æŸ¥Nginxé…ç½®
```

### 3. æƒé™é”™è¯¯

**é—®é¢˜**: `Permission denied`

**è§£å†³**:
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
chmod -R 755 staticfiles/
chmod -R 755 media/
```

### 4. ç«¯å£è¢«å ç”¨

**é—®é¢˜**: `Address already in use`

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8000  # Linux/Mac
netstat -ano | findstr :8000  # Windows

# ä¿®æ”¹ç«¯å£æˆ–åœæ­¢å ç”¨è¿›ç¨‹
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æ—¥å¿—æ–‡ä»¶**
   - Docker: `docker-compose logs`
   - Gunicorn: `/var/log/gunicorn/`
   - Nginx: `/var/log/nginx/`

2. **é…ç½®æ–‡ä»¶**
   - `.env` æ–‡ä»¶
   - `settings.py`
   - `docker-compose.yml`
   - `nginx.conf`

3. **ç³»ç»Ÿèµ„æº**
   - ç£ç›˜ç©ºé—´
   - å†…å­˜ä½¿ç”¨
   - CPUä½¿ç”¨ç‡

---

**éƒ¨ç½²å®Œæˆåï¼Œè®¿é—® http://your-domain/ å¼€å§‹ä½¿ç”¨ï¼** ğŸš€




