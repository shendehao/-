# ğŸ¨ å‰ç«¯JavaScripté›†æˆè¯´æ˜

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. APIå®¢æˆ·ç«¯ (`templates/static/js/api.js`)
- âœ… å®Œæ•´çš„HTTPè¯·æ±‚å°è£…
- âœ… Tokenè‡ªåŠ¨ç®¡ç†
- âœ… Tokenè‡ªåŠ¨åˆ·æ–°
- âœ… æ‰€æœ‰APIæ¥å£å°è£…
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†

### 2. åº”ç”¨ä¸»è„šæœ¬ (`templates/static/js/app.js`)
- âœ… é¡µé¢å¯¼èˆªç®¡ç†
- âœ… æ•°æ®åŠ è½½æ§åˆ¶å™¨
- âœ… UIæ¸²æŸ“å‡½æ•°
- âœ… äº‹ä»¶ç»‘å®š
- âœ… å·¥å…·å‡½æ•°

---

## ğŸš€ å¿«é€Ÿé›†æˆ

### ç¬¬ä¸€æ­¥ï¼šåœ¨HTMLä¸­å¼•å…¥è„šæœ¬

åœ¨ `templates/index.html` çš„ `</body>` æ ‡ç­¾å‰æ·»åŠ ï¼š

```html
<!-- APIå®¢æˆ·ç«¯ -->
<script src="/static/js/api.js"></script>

<!-- åº”ç”¨ä¸»è„šæœ¬ -->
<script src="/static/js/app.js"></script>
```

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ å¿…è¦çš„ID

ç¡®ä¿HTMLå…ƒç´ æœ‰æ­£ç¡®çš„IDï¼Œä»¥ä¾¿JavaScriptå¯ä»¥æ“ä½œå®ƒä»¬ã€‚

#### ä»ªè¡¨ç›˜é¡µé¢éœ€è¦çš„IDï¼š

```html
<!-- ç»Ÿè®¡å¡ç‰‡ -->
<span id="total-items">0</span>
<span id="total-stock">0</span>
<span id="total-value">0</span>
<span id="low-stock-count">0</span>
<span id="today-inbound">0</span>
<span id="today-outbound">0</span>

<!-- å®¹å™¨ -->
<div id="recent-activities"></div>
<div id="low-stock-items"></div>
```

#### ç‰©å“åˆ—è¡¨é¡µé¢éœ€è¦çš„IDï¼š

```html
<!-- æœç´¢æ¡† -->
<input type="text" id="items-search" placeholder="æœç´¢...">

<!-- ç±»åˆ«è¿‡æ»¤ -->
<select id="category-filter">
  <option value="">æ‰€æœ‰ç±»åˆ«</option>
</select>

<!-- è¡¨æ ¼ -->
<tbody id="items-table-body"></tbody>

<!-- æ€»æ•°æ˜¾ç¤º -->
<span id="items-total">0</span>

<!-- åˆ†é¡µå®¹å™¨ -->
<div id="items-pagination"></div>
```

#### å…¥åº“/å‡ºåº“é¡µé¢éœ€è¦çš„IDï¼š

```html
<tbody id="inbound-table-body"></tbody>
<tbody id="outbound-table-body"></tbody>
```

#### ä»“åº“é¡µé¢éœ€è¦çš„IDï¼š

```html
<div id="warehouse-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
```

#### ä¾›åº”å•†é¡µé¢éœ€è¦çš„IDï¼š

```html
<tbody id="supplier-table-body"></tbody>
```

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ å¯¼èˆªå±æ€§

ä¸ºå¯¼èˆªèœå•é¡¹æ·»åŠ  `data-page` å±æ€§ï¼š

```html
<a href="#" class="nav-item" data-page="dashboard-page">
  <i class="fas fa-home"></i>
  <span>ä»ªè¡¨ç›˜</span>
</a>

<a href="#" class="nav-item" data-page="items-page">
  <i class="fas fa-box"></i>
  <span>åº“å­˜ç‰©å“</span>
</a>

<a href="#" class="nav-item" data-page="inbound-page">
  <i class="fas fa-arrow-down"></i>
  <span>å…¥åº“ç®¡ç†</span>
</a>

<a href="#" class="nav-item" data-page="outbound-page">
  <i class="fas fa-arrow-up"></i>
  <span>å‡ºåº“ç®¡ç†</span>
</a>

<a href="#" class="nav-item" data-page="warehouse-page">
  <i class="fas fa-warehouse"></i>
  <span>ä»“åº“ç®¡ç†</span>
</a>

<a href="#" class="nav-item" data-page="supplier-page">
  <i class="fas fa-truck"></i>
  <span>ä¾›åº”å•†</span>
</a>
```

---

## ğŸ“¡ APIä½¿ç”¨ç¤ºä¾‹

### 1. ç™»å½•

```javascript
// ç”¨æˆ·ç™»å½•
async function login() {
  try {
    const result = await API.Auth.login('admin', 'admin123');
    
    // ä¿å­˜Token
    API.TokenManager.setToken(result.data.token);
    API.TokenManager.setRefreshToken(result.data.refresh_token);
    API.TokenManager.setUserInfo(result.data.user);
    
    console.log('ç™»å½•æˆåŠŸ', result.data.user);
    
    // è·³è½¬åˆ°ä¸»é¡µ
    window.location.href = '/';
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥', error);
    alert('ç™»å½•å¤±è´¥: ' + error.message);
  }
}
```

### 2. è·å–æ•°æ®

```javascript
// è·å–ç‰©å“åˆ—è¡¨
async function loadItems() {
  try {
    const result = await API.Inventory.getItems({
      page: 1,
      page_size: 10,
      search: 'é¼ æ ‡'
    });
    
    console.log('ç‰©å“åˆ—è¡¨', result.data);
    // æ¸²æŸ“åˆ°é¡µé¢
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥', error);
  }
}

// è·å–ä»ªè¡¨ç›˜æ•°æ®
async function loadDashboard() {
  const overview = await API.Dashboard.getOverview();
  const activities = await API.Dashboard.getActivities(10);
  const lowStock = await API.Dashboard.getLowStock();
  
  console.log('æ¦‚è§ˆ', overview.data);
  console.log('æ´»åŠ¨', activities.data);
  console.log('ä½åº“å­˜', lowStock.data);
}
```

### 3. åˆ›å»ºæ•°æ®

```javascript
// åˆ›å»ºç‰©å“
async function createItem() {
  try {
    const result = await API.Inventory.createItem({
      name: 'æ–°ç‰©å“',
      code: 'NEW-001',
      category: 1,
      warehouse: 1,
      price: '99.00',
      stock: 100,
      min_stock: 20
    });
    
    console.log('åˆ›å»ºæˆåŠŸ', result.data);
    alert('ç‰©å“åˆ›å»ºæˆåŠŸï¼');
  } catch (error) {
    console.error('åˆ›å»ºå¤±è´¥', error);
    alert('åˆ›å»ºå¤±è´¥: ' + error.message);
  }
}
```

### 4. å…¥åº“/å‡ºåº“æ“ä½œ

```javascript
// å…¥åº“
async function inbound() {
  try {
    const result = await API.Operation.inbound({
      item: 1,
      quantity: 50,
      supplier: 1,
      notes: 'é‡‡è´­å…¥åº“'
    });
    
    console.log('å…¥åº“æˆåŠŸ', result.data);
    alert(`å…¥åº“æˆåŠŸï¼åº“å­˜ä» ${result.data.before_stock} å¢åŠ åˆ° ${result.data.after_stock}`);
  } catch (error) {
    alert('å…¥åº“å¤±è´¥: ' + error.message);
  }
}

// å‡ºåº“
async function outbound() {
  try {
    const result = await API.Operation.outbound({
      item: 1,
      quantity: 10,
      recipient: 'å¼ ä¸‰',
      department: 'æŠ€æœ¯éƒ¨',
      purpose: 'åŠå…¬ä½¿ç”¨'
    });
    
    console.log('å‡ºåº“æˆåŠŸ', result.data);
    alert('å‡ºåº“æˆåŠŸï¼');
  } catch (error) {
    alert('å‡ºåº“å¤±è´¥: ' + error.message);
  }
}
```

---

## ğŸ¯ å·²å®ç°çš„åŠŸèƒ½

### è‡ªåŠ¨åŠŸèƒ½
- âœ… é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
- âœ… åˆ‡æ¢é¡µé¢æ—¶è‡ªåŠ¨åŠ è½½å¯¹åº”æ•°æ®
- âœ… Tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°
- âœ… è®¤è¯å¤±è´¥è‡ªåŠ¨è·³è½¬ç™»å½•

### æ•°æ®æ¸²æŸ“
- âœ… ä»ªè¡¨ç›˜æ¦‚è§ˆæ•°æ®
- âœ… æœ€è¿‘æ´»åŠ¨åˆ—è¡¨
- âœ… ä½åº“å­˜ç‰©å“åˆ—è¡¨
- âœ… ç‰©å“åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
- âœ… å…¥åº“è®°å½•åˆ—è¡¨
- âœ… å‡ºåº“è®°å½•åˆ—è¡¨
- âœ… ä»“åº“å¡ç‰‡å±•ç¤º
- âœ… ä¾›åº”å•†åˆ—è¡¨

### äº¤äº’åŠŸèƒ½
- âœ… é¡µé¢å¯¼èˆªåˆ‡æ¢
- âœ… æœç´¢é˜²æŠ–
- âœ… åˆ é™¤ç¡®è®¤
- âœ… æˆåŠŸ/é”™è¯¯æç¤º

---

## ğŸ”§ è‡ªå®šä¹‰å’Œæ‰©å±•

### 1. ä¿®æ”¹APIåŸºç¡€URL

åœ¨ `api.js` ä¸­ä¿®æ”¹ï¼š

```javascript
const API_CONFIG = {
    baseURL: 'http://your-domain.com/api',  // ä¿®æ”¹è¿™é‡Œ
    timeout: 30000,
};
```

### 2. è‡ªå®šä¹‰é”™è¯¯å¤„ç†

åœ¨ `app.js` ä¸­ä¿®æ”¹ `Utils.showError`ï¼š

```javascript
showError(message) {
    // ä½¿ç”¨ä½ å–œæ¬¢çš„æç¤ºåº“
    // ä¾‹å¦‚: toastr.error(message);
    // æˆ–è€…: Swal.fire('é”™è¯¯', message, 'error');
    alert('é”™è¯¯: ' + message);
}
```

### 3. æ·»åŠ æ–°çš„æ§åˆ¶å™¨

```javascript
const NewController = {
    async loadData() {
        try {
            const data = await API.YourAPI.getData();
            this.renderData(data.data);
        } catch (error) {
            Utils.showError('åŠ è½½å¤±è´¥: ' + error.message);
        }
    },
    
    renderData(data) {
        // æ¸²æŸ“é€»è¾‘
    }
};
```

### 4. æ·»åŠ æ–°çš„APIæ¥å£

åœ¨ `api.js` ä¸­æ·»åŠ ï¼š

```javascript
const YourAPI = {
    getData() {
        return http.get('/your-endpoint/');
    },
    
    createData(data) {
        return http.post('/your-endpoint/', data);
    },
};

// å¯¼å‡º
window.API = {
    // ... å…¶ä»–API
    Your: YourAPI,
};
```

---

## ğŸ“ å¼€å‘å»ºè®®

### 1. è°ƒè¯•æŠ€å·§

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

```javascript
// æ‰€æœ‰APIè°ƒç”¨éƒ½ä¼šæœ‰æ—¥å¿—
âœ… APIå®¢æˆ·ç«¯å·²åŠ è½½
âœ… åº”ç”¨è„šæœ¬å·²åŠ è½½
ğŸš€ åˆå§‹åŒ–åº”ç”¨...
âœ… ä»ªè¡¨ç›˜æ¦‚è§ˆæ•°æ®å·²æ›´æ–°
âœ… æœ€è¿‘æ´»åŠ¨å·²æ›´æ–° 10 æ¡
âœ… ä½åº“å­˜ç‰©å“å·²æ›´æ–° 3 ä¸ª
```

### 2. æµ‹è¯•API

åœ¨æµè§ˆå™¨æ§åˆ¶å°ç›´æ¥è°ƒç”¨ï¼š

```javascript
// æµ‹è¯•ç™»å½•
API.Auth.login('admin', 'admin123').then(console.log);

// æµ‹è¯•è·å–æ•°æ®
API.Inventory.getItems().then(console.log);

// æµ‹è¯•å…¥åº“
API.Operation.inbound({
  item: 1,
  quantity: 10,
  supplier: 1
}).then(console.log);
```

### 3. æŸ¥çœ‹å½“å‰çŠ¶æ€

```javascript
// æŸ¥çœ‹Token
console.log(API.TokenManager.getToken());

// æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
console.log(API.TokenManager.getUserInfo());

// æŸ¥çœ‹å½“å‰é¡µé¢
console.log(App.PageManager.currentPage);
```

---

## ğŸ¨ UIå¢å¼ºå»ºè®®

### 1. æ·»åŠ LoadingåŠ¨ç”»

```javascript
Utils.showLoading = function(message) {
    // æ˜¾ç¤ºloadingé®ç½©
    const loading = document.createElement('div');
    loading.id = 'loading-overlay';
    loading.innerHTML = `
        <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6">
                <i class="fas fa-spinner fa-spin text-3xl text-primary"></i>
                <p class="mt-2">${message}</p>
            </div>
        </div>
    `;
    document.body.appendChild(loading);
};

Utils.hideLoading = function() {
    const loading = document.getElementById('loading-overlay');
    if (loading) loading.remove();
};
```

### 2. æ·»åŠ Toastæç¤º

ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚ `toastr` æˆ– `sweetalert2`ï¼š

```html
<!-- å¼•å…¥toastr -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
```

```javascript
Utils.showSuccess = function(message) {
    toastr.success(message);
};

Utils.showError = function(message) {
    toastr.error(message);
};
```

### 3. æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†

```javascript
async function deleteItem(id) {
    const confirmed = await Swal.fire({
        title: 'ç¡®å®šåˆ é™¤ï¼Ÿ',
        text: 'æ­¤æ“ä½œä¸å¯æ’¤é”€',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'ç¡®å®š',
        cancelButtonText: 'å–æ¶ˆ'
    });
    
    if (confirmed.isConfirmed) {
        // æ‰§è¡Œåˆ é™¤
    }
}
```

---

## âœ… æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½
- [ ] é¡µé¢åŠ è½½æ­£å¸¸
- [ ] è„šæœ¬æ— é”™è¯¯
- [ ] æ§åˆ¶å°æœ‰æ­£ç¡®æ—¥å¿—

### æ•°æ®åŠ è½½
- [ ] ä»ªè¡¨ç›˜æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] ç‰©å“åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] å…¥åº“è®°å½•æ­£å¸¸æ˜¾ç¤º
- [ ] å‡ºåº“è®°å½•æ­£å¸¸æ˜¾ç¤º
- [ ] ä»“åº“æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] ä¾›åº”å•†æ•°æ®æ­£å¸¸æ˜¾ç¤º

### äº¤äº’åŠŸèƒ½
- [ ] é¡µé¢å¯¼èˆªæ­£å¸¸åˆ‡æ¢
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] è¿‡æ»¤åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸

### é”™è¯¯å¤„ç†
- [ ] APIé”™è¯¯æœ‰æç¤º
- [ ] Tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°
- [ ] ç½‘ç»œé”™è¯¯æœ‰æç¤º

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ§åˆ¶å°æŠ¥é”™ï¼šAPI is not defined

**åŸå› **: api.jsæœªæ­£ç¡®åŠ è½½

**è§£å†³**: æ£€æŸ¥scriptæ ‡ç­¾é¡ºåºï¼Œapi.jså¿…é¡»åœ¨app.jsä¹‹å‰

### 2. æ•°æ®ä¸æ˜¾ç¤º

**åŸå› **: HTMLå…ƒç´ IDä¸åŒ¹é…

**è§£å†³**: æ£€æŸ¥HTMLå…ƒç´ æ˜¯å¦æœ‰æ­£ç¡®çš„ID

### 3. Tokenè¿‡æœŸ

**åŸå› **: Tokenæœ‰æ•ˆæœŸé»˜è®¤5åˆ†é’Ÿ

**è§£å†³**: 
- ä¼šè‡ªåŠ¨åˆ·æ–°Token
- å¦‚æœåˆ·æ–°å¤±è´¥ä¼šè·³è½¬ç™»å½•é¡µ

### 4. CORSé”™è¯¯

**åŸå› **: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢

**è§£å†³**: 
- ç¡®ä¿Django CORSé…ç½®æ­£ç¡®
- æ£€æŸ¥ `settings.py` ä¸­çš„ `CORS_ALLOWED_ORIGINS`

---

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘

### çŸ­æœŸä»»åŠ¡
1. âš ï¸ å®Œå–„è¡¨å•éªŒè¯
2. âš ï¸ æ·»åŠ å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
3. âš ï¸ å®ç°æ¨¡æ€æ¡†äº¤äº’
4. âš ï¸ æ·»åŠ å›¾è¡¨å¯è§†åŒ–

### ä¸­æœŸä»»åŠ¡
1. âš ï¸ å®ç°æ‰¹é‡æ“ä½œ
2. âš ï¸ æ·»åŠ å¯¼å‡ºåŠŸèƒ½
3. âš ï¸ å®ç°æ‰“å°åŠŸèƒ½
4. âš ï¸ æ·»åŠ å®æ—¶é€šçŸ¥

### é•¿æœŸä»»åŠ¡
1. âš ï¸ å¼€å‘Flutterç§»åŠ¨ç«¯
2. âš ï¸ å®ç°ç¦»çº¿åŠŸèƒ½
3. âš ï¸ æ·»åŠ æ•°æ®åŒæ­¥
4. âš ï¸ æ€§èƒ½ä¼˜åŒ–

---

**ç°åœ¨å°±æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œå¼€å§‹æµ‹è¯•å§ï¼** ğŸš€

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
API.Dashboard.getOverview().then(console.log);
```
