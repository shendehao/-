# 🔍 扫码入库功能实现计划

## 功能概述

实现一个完整的条码/二维码扫描入库系统：
1. 添加物品时自动生成唯一编码
2. 显示物品的二维码
3. 支持扫码枪/摄像头扫描
4. 扫描后快速入库

---

## ✅ 已完成

### 1. 后端自动生成编码
- ✅ 修改 `ItemSerializer.create()` 方法
- ✅ 自动生成格式: `ITEM-20241206-XXXX`
- ✅ 如果用户不填编码，系统自动生成
- ✅ 同时生成barcode字段

### 2. 前端表单优化
- ✅ 物品编码改为可选
- ✅ 添加提示"留空自动生成"

---

## 🚀 待实现

### 3. 添加二维码显示功能

**位置**: 物品详情页/物品列表

**需要**:
- 引入二维码生成库 (qrcode.js)
- 在物品详情中显示二维码
- 二维码内容: 物品编码

**HTML**:
```html
<div class="qrcode-container">
  <div id="qrcode-{item.id}"></div>
  <p>{item.code}</p>
  <button>打印标签</button>
</div>
```

### 4. 实现扫码输入监听

**原理**: 扫码枪模拟键盘输入
- 监听键盘输入
- 识别快速连续输入（扫码枪特征）
- 自动触发查询

**JavaScript**:
```javascript
const ScannerManager = {
  buffer: '',
  timer: null,
  
  init() {
    document.addEventListener('keypress', (e) => {
      // 累积输入
      this.buffer += e.key;
      
      // 清除旧定时器
      clearTimeout(this.timer);
      
      // 100ms内没有新输入，认为扫描完成
      this.timer = setTimeout(() => {
        if (this.buffer.length > 5) {
          this.handleScan(this.buffer);
        }
        this.buffer = '';
      }, 100);
    });
  },
  
  handleScan(code) {
    // 查询物品
    // 显示快速入库弹窗
  }
};
```

### 5. 创建快速入库弹窗

**功能**:
- 扫描后自动弹出
- 显示物品信息
- 输入入库数量
- 一键确认入库

**HTML**:
```html
<div id="quick-inbound-modal" class="hidden">
  <div class="modal-content">
    <h3>扫码入库</h3>
    <div class="item-info">
      <img src="{item.image}" />
      <h4>{item.name}</h4>
      <p>编码: {item.code}</p>
      <p>当前库存: {item.stock}</p>
    </div>
    <input type="number" placeholder="入库数量" />
    <button>确认入库</button>
  </div>
</div>
```

### 6. API集成

**需要的API**:
- `GET /api/inventory/items/?code={code}` - 根据编码查询物品
- `POST /api/operations/inbound/` - 创建入库记录

---

## 📋 完整流程

### 流程A: 添加新物品
1. 用户填写物品信息
2. 不填编码（或填写自定义编码）
3. 提交表单
4. 后端自动生成唯一编码
5. 返回物品信息（包含编码和二维码）
6. 前端显示二维码
7. 用户可以打印标签

### 流程B: 扫码入库
1. 用户使用扫码枪扫描物品标签
2. 系统监听到扫码输入
3. 自动查询物品信息
4. 弹出快速入库窗口
5. 显示物品详情
6. 用户输入入库数量
7. 点击确认
8. 创建入库记录
9. 更新库存
10. 显示成功提示

---

## 🛠️ 技术选型

### 二维码生成
- **库**: qrcode.js
- **CDN**: https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js
- **用法**:
```javascript
new QRCode(element, {
  text: "ITEM-20241206-XXXX",
  width: 128,
  height: 128
});
```

### 扫码枪支持
- 扫码枪模拟键盘输入
- 特点: 快速连续输入 + 回车
- 监听keypress事件
- 100ms超时判断扫描完成

### 摄像头扫描（可选）
- **库**: html5-qrcode
- **功能**: 使用手机/电脑摄像头扫描
- **适用**: 没有扫码枪的情况

---

## 📱 用户界面设计

### 1. 仪表盘添加按钮
```
┌─────────────────────────────┐
│ [📊 导出报告] [➕ 添加物品] │
│ [🔍 扫码入库] ← 新增        │
└─────────────────────────────┘
```

### 2. 物品详情显示二维码
```
┌─────────────────────────────┐
│ 物品名称: 笔记本电脑包      │
│ 编码: ITEM-20241206-A1B2    │
│                             │
│ ┌─────────┐                │
│ │ QR CODE │                │
│ │  █ █ █  │                │
│ │ █ █ █ █ │                │
│ └─────────┘                │
│                             │
│ [打印标签] [下载二维码]     │
└─────────────────────────────┘
```

### 3. 快速入库弹窗
```
┌─────────────────────────────┐
│ 🔍 扫码入库                 │
├─────────────────────────────┤
│ [图片]  笔记本电脑包        │
│         ITEM-20241206-A1B2  │
│         当前库存: 5         │
│                             │
│ 入库数量: [____] 件         │
│                             │
│ [取消]  [确认入库]          │
└─────────────────────────────┘
```

---

## 🎯 下一步行动

1. 添加二维码生成库
2. 在物品列表/详情显示二维码
3. 实现扫码监听
4. 创建快速入库弹窗
5. 测试完整流程

---

## 💡 扩展功能（未来）

- 批量打印标签
- 扫码出库
- 扫码盘点
- 移动端扫描
- 标签模板自定义
- 支持多种条码格式（EAN-13, Code128等）

---

**准备好开始实现了吗？** 🚀
