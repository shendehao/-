# åº“å­˜ç®¡ç†ç³»ç»Ÿ - åç«¯å¼€å‘æ–‡æ¡£

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Django 4.2+
- **API**: Django REST Framework 3.14+
- **æ•°æ®åº“**: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
- **è®¤è¯**: JWT (djangorestframework-simplejwt)
- **ç¼“å­˜**: Redis (å¯é€‰)
- **æ–‡ä»¶å­˜å‚¨**: Django Media / äº‘å­˜å‚¨
- **éƒ¨ç½²**: Docker + Gunicorn + Nginx

### é¡¹ç›®ç‰¹ç‚¹
- âœ… RESTful API è®¾è®¡
- âœ… JWT Token è®¤è¯
- âœ… ç»Ÿä¸€å“åº”æ ¼å¼
- âœ… å®Œæ•´çš„æƒé™æ§åˆ¶
- âœ… æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- âœ… è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
inventory_system/
â”œâ”€â”€ manage.py                      # Djangoç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ Dockerfile                    # Dockeré…ç½®
â”œâ”€â”€ docker-compose.yml            # Dockerç¼–æ’
â”‚
â”œâ”€â”€ config/                       # é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py              # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ urls.py                  # ä¸»è·¯ç”±
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â”‚
â”œâ”€â”€ apps/                        # åº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ authentication/          # ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py           # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ serializers.py      # åºåˆ—åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ views.py            # è§†å›¾
â”‚   â”‚   â”œâ”€â”€ urls.py             # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ permissions.py      # æƒé™
â”‚   â”‚   â””â”€â”€ tests.py            # æµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ inventory/               # åº“å­˜ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py           # ç‰©å“ã€ç±»åˆ«ç­‰æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â”œâ”€â”€ filters.py          # è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ signals.py          # ä¿¡å·å¤„ç†
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ operations/              # å‡ºå…¥åº“æ“ä½œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py           # å…¥åº“ã€å‡ºåº“ã€è°ƒæ‹¨è®°å½•
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/               # ä»ªè¡¨ç›˜ç»Ÿè®¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ views.py            # ç»Ÿè®¡è§†å›¾
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â”œâ”€â”€ services.py         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ suppliers/               # ä¾›åº”å•†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â”œâ”€â”€ warehouses/              # ä»“åº“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ tests.py
â”‚   â”‚
â”‚   â””â”€â”€ reports/                 # æŠ¥è¡¨æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ views.py
â”‚       â”œâ”€â”€ urls.py
â”‚       â”œâ”€â”€ generators.py        # æŠ¥è¡¨ç”Ÿæˆå™¨
â”‚       â””â”€â”€ tests.py
â”‚
â”œâ”€â”€ common/                      # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mixins.py               # é€šç”¨Mixin
â”‚   â”œâ”€â”€ pagination.py           # åˆ†é¡µ
â”‚   â”œâ”€â”€ responses.py            # ç»Ÿä¸€å“åº”
â”‚   â”œâ”€â”€ exceptions.py           # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ validators.py           # éªŒè¯å™¨
â”‚   â””â”€â”€ utils.py                # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ static/                      # é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”‚
â”œâ”€â”€ media/                       # åª’ä½“æ–‡ä»¶
â”‚   â””â”€â”€ items/                  # ç‰©å“å›¾ç‰‡
â”‚
â””â”€â”€ templates/                   # æ¨¡æ¿æ–‡ä»¶
    â”œâ”€â”€ base.html
    â”œâ”€â”€ index.html              # ä½ çš„å‰ç«¯æ¨¡æ¿
    â””â”€â”€ admin/
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### ERå›¾æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚       â”‚   Category   â”‚       â”‚  Supplier   â”‚
â”‚  (ç”¨æˆ·)      â”‚       â”‚   (ç±»åˆ«)      â”‚       â”‚  (ä¾›åº”å•†)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚                      â”‚
       â”‚                      â”‚                      â”‚
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
       â”‚              â”‚          Item (ç‰©å“)               â”‚
       â”‚              â”‚  - name, code, price, stock       â”‚
       â”‚              â”‚  - min_stock, warehouse_location  â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚
       â”‚                      â”‚
       â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      InventoryOperation (åº“å­˜æ“ä½œ)       â”‚
â”‚  - operation_type (in/out/transfer)    â”‚
â”‚  - quantity, notes, operator           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å‹å®šä¹‰

#### 1. User (ç”¨æˆ·æ¨¡å‹)

```python
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    """è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹"""
    phone = models.CharField(max_length=20, blank=True)
    avatar = models.ImageField(upload_to='avatars/', null=True, blank=True)
    department = models.CharField(max_length=100, blank=True)
    role = models.CharField(
        max_length=20,
        choices=[
            ('admin', 'ç®¡ç†å‘˜'),
            ('manager', 'ä»“åº“ç®¡ç†å‘˜'),
            ('operator', 'æ“ä½œå‘˜'),
            ('viewer', 'æŸ¥çœ‹è€…')
        ],
        default='operator'
    )
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

#### 2. Category (ç±»åˆ«æ¨¡å‹)

```python
class Category(models.Model):
    """ç‰©å“ç±»åˆ«"""
    name = models.CharField(max_length=100, unique=True, verbose_name='ç±»åˆ«åç§°')
    code = models.CharField(max_length=50, unique=True, verbose_name='ç±»åˆ«ç¼–ç ')
    description = models.TextField(blank=True, verbose_name='æè¿°')
    parent = models.ForeignKey(
        'self', 
        on_delete=models.CASCADE, 
        null=True, 
        blank=True,
        related_name='children',
        verbose_name='çˆ¶ç±»åˆ«'
    )
    is_active = models.BooleanField(default=True, verbose_name='æ˜¯å¦å¯ç”¨')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'categories'
        verbose_name = 'ç±»åˆ«'
        verbose_name_plural = 'ç±»åˆ«'
        ordering = ['code']

    def __str__(self):
        return self.name
```

#### 3. Supplier (ä¾›åº”å•†æ¨¡å‹)

```python
class Supplier(models.Model):
    """ä¾›åº”å•†"""
    name = models.CharField(max_length=200, verbose_name='ä¾›åº”å•†åç§°')
    code = models.CharField(max_length=50, unique=True, verbose_name='ä¾›åº”å•†ç¼–ç ')
    contact = models.CharField(max_length=100, verbose_name='è”ç³»äºº')
    phone = models.CharField(max_length=20, verbose_name='è”ç³»ç”µè¯')
    email = models.EmailField(blank=True, verbose_name='é‚®ç®±')
    address = models.TextField(blank=True, verbose_name='åœ°å€')
    status = models.CharField(
        max_length=20,
        choices=[
            ('active', 'å¯ç”¨'),
            ('inactive', 'åœç”¨')
        ],
        default='active',
        verbose_name='çŠ¶æ€'
    )
    notes = models.TextField(blank=True, verbose_name='å¤‡æ³¨')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'suppliers'
        verbose_name = 'ä¾›åº”å•†'
        verbose_name_plural = 'ä¾›åº”å•†'
        ordering = ['-created_at']

    def __str__(self):
        return self.name
```

#### 4. Warehouse (ä»“åº“æ¨¡å‹)

```python
class Warehouse(models.Model):
    """ä»“åº“"""
    name = models.CharField(max_length=200, verbose_name='ä»“åº“åç§°')
    code = models.CharField(max_length=50, unique=True, verbose_name='ä»“åº“ç¼–ç ')
    location = models.CharField(max_length=500, verbose_name='ä½ç½®')
    capacity = models.IntegerField(verbose_name='å®¹é‡')
    manager = models.CharField(max_length=100, verbose_name='è´Ÿè´£äºº')
    phone = models.CharField(max_length=20, verbose_name='è”ç³»ç”µè¯')
    is_active = models.BooleanField(default=True, verbose_name='æ˜¯å¦å¯ç”¨')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'warehouses'
        verbose_name = 'ä»“åº“'
        verbose_name_plural = 'ä»“åº“'

    def __str__(self):
        return self.name

    @property
    def current_usage(self):
        """å½“å‰ä½¿ç”¨é‡"""
        return self.items.aggregate(
            total=models.Sum('stock')
        )['total'] or 0

    @property
    def usage_rate(self):
        """ä½¿ç”¨ç‡"""
        if self.capacity > 0:
            return round(self.current_usage / self.capacity * 100, 2)
        return 0
```

#### 5. Item (ç‰©å“æ¨¡å‹)

```python
class Item(models.Model):
    """åº“å­˜ç‰©å“"""
    name = models.CharField(max_length=200, verbose_name='ç‰©å“åç§°')
    code = models.CharField(max_length=100, unique=True, verbose_name='ç‰©å“ç¼–ç ')
    barcode = models.CharField(max_length=100, blank=True, verbose_name='æ¡å½¢ç ')
    category = models.ForeignKey(
        Category,
        on_delete=models.PROTECT,
        related_name='items',
        verbose_name='ç±»åˆ«'
    )
    supplier = models.ForeignKey(
        Supplier,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='items',
        verbose_name='ä¾›åº”å•†'
    )
    warehouse = models.ForeignKey(
        Warehouse,
        on_delete=models.PROTECT,
        related_name='items',
        verbose_name='ä»“åº“'
    )
    price = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        verbose_name='å•ä»·'
    )
    stock = models.IntegerField(default=0, verbose_name='åº“å­˜æ•°é‡')
    min_stock = models.IntegerField(default=0, verbose_name='æœ€ä½åº“å­˜')
    warehouse_location = models.CharField(
        max_length=100,
        blank=True,
        verbose_name='ä»“ä½'
    )
    description = models.TextField(blank=True, verbose_name='æè¿°')
    image = models.ImageField(
        upload_to='items/%Y/%m/',
        null=True,
        blank=True,
        verbose_name='å›¾ç‰‡'
    )
    status = models.CharField(
        max_length=20,
        choices=[
            ('normal', 'æ­£å¸¸'),
            ('low_stock', 'ä½åº“å­˜'),
            ('out_of_stock', 'ç¼ºè´§'),
            ('discontinued', 'åœäº§')
        ],
        default='normal',
        verbose_name='çŠ¶æ€'
    )
    created_by = models.ForeignKey(
        User,
        on_delete=models.SET_NULL,
        null=True,
        related_name='created_items',
        verbose_name='åˆ›å»ºäºº'
    )
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'items'
        verbose_name = 'ç‰©å“'
        verbose_name_plural = 'ç‰©å“'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['code']),
            models.Index(fields=['barcode']),
            models.Index(fields=['status']),
        ]

    def __str__(self):
        return f"{self.name} ({self.code})"

    def save(self, *args, **kwargs):
        """ä¿å­˜æ—¶è‡ªåŠ¨æ›´æ–°çŠ¶æ€"""
        if self.stock <= 0:
            self.status = 'out_of_stock'
        elif self.stock <= self.min_stock:
            self.status = 'low_stock'
        else:
            self.status = 'normal'
        super().save(*args, **kwargs)

    @property
    def total_value(self):
        """åº“å­˜æ€»ä»·å€¼"""
        return self.stock * self.price
```

#### 6. InventoryOperation (åº“å­˜æ“ä½œæ¨¡å‹)

```python
class InventoryOperation(models.Model):
    """åº“å­˜æ“ä½œè®°å½•"""
    OPERATION_TYPES = [
        ('in', 'å…¥åº“'),
        ('out', 'å‡ºåº“'),
        ('transfer', 'è°ƒæ‹¨'),
        ('adjust', 'è°ƒæ•´'),
        ('check', 'ç›˜ç‚¹')
    ]

    item = models.ForeignKey(
        Item,
        on_delete=models.PROTECT,
        related_name='operations',
        verbose_name='ç‰©å“'
    )
    operation_type = models.CharField(
        max_length=20,
        choices=OPERATION_TYPES,
        verbose_name='æ“ä½œç±»å‹'
    )
    quantity = models.IntegerField(verbose_name='æ•°é‡')
    before_stock = models.IntegerField(verbose_name='æ“ä½œå‰åº“å­˜')
    after_stock = models.IntegerField(verbose_name='æ“ä½œååº“å­˜')
    
    # å…¥åº“ç›¸å…³
    supplier = models.ForeignKey(
        Supplier,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        verbose_name='ä¾›åº”å•†'
    )
    
    # å‡ºåº“ç›¸å…³
    recipient = models.CharField(
        max_length=100,
        blank=True,
        verbose_name='é¢†ç”¨äºº'
    )
    department = models.CharField(
        max_length=100,
        blank=True,
        verbose_name='é¢†ç”¨éƒ¨é—¨'
    )
    purpose = models.CharField(
        max_length=200,
        blank=True,
        verbose_name='ç”¨é€”'
    )
    
    # è°ƒæ‹¨ç›¸å…³
    from_warehouse = models.CharField(
        max_length=100,
        blank=True,
        verbose_name='æºä»“åº“'
    )
    to_warehouse = models.CharField(
        max_length=100,
        blank=True,
        verbose_name='ç›®æ ‡ä»“åº“'
    )
    
    # é€šç”¨å­—æ®µ
    notes = models.TextField(blank=True, verbose_name='å¤‡æ³¨')
    operator = models.ForeignKey(
        User,
        on_delete=models.SET_NULL,
        null=True,
        related_name='operations',
        verbose_name='æ“ä½œäºº'
    )
    created_at = models.DateTimeField(auto_now_add=True, verbose_name='æ“ä½œæ—¶é—´')

    class Meta:
        db_table = 'inventory_operations'
        verbose_name = 'åº“å­˜æ“ä½œ'
        verbose_name_plural = 'åº“å­˜æ“ä½œ'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['operation_type']),
            models.Index(fields=['created_at']),
        ]

    def __str__(self):
        return f"{self.get_operation_type_display()} - {self.item.name} - {self.quantity}"
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ç»Ÿä¸€å“åº”æ ¼å¼

**æ–‡ä»¶**: `common/responses.py`

```python
from rest_framework.response import Response
from rest_framework import status

class APIResponse:
    """ç»Ÿä¸€APIå“åº”æ ¼å¼"""
    
    @staticmethod
    def success(data=None, message='æ“ä½œæˆåŠŸ', status_code=status.HTTP_200_OK):
        """æˆåŠŸå“åº”"""
        return Response({
            'success': True,
            'message': message,
            'data': data
        }, status=status_code)
    
    @staticmethod
    def error(message='æ“ä½œå¤±è´¥', code='ERROR', details=None, status_code=status.HTTP_400_BAD_REQUEST):
        """é”™è¯¯å“åº”"""
        return Response({
            'success': False,
            'error': {
                'code': code,
                'message': message,
                'details': details
            }
        }, status=status_code)
    
    @staticmethod
    def paginated(queryset, serializer_class, request, message='è·å–æˆåŠŸ'):
        """åˆ†é¡µå“åº”"""
        from .pagination import StandardPagination
        
        paginator = StandardPagination()
        page = paginator.paginate_queryset(queryset, request)
        
        if page is not None:
            serializer = serializer_class(page, many=True)
            return paginator.get_paginated_response(serializer.data)
        
        serializer = serializer_class(queryset, many=True)
        return APIResponse.success(serializer.data, message)
```

### 2. è‡ªå®šä¹‰åˆ†é¡µ

**æ–‡ä»¶**: `common/pagination.py`

```python
from rest_framework.pagination import PageNumberPagination
from rest_framework.response import Response

class StandardPagination(PageNumberPagination):
    """æ ‡å‡†åˆ†é¡µ"""
    page_size = 20
    page_size_query_param = 'page_size'
    max_page_size = 100
    page_query_param = 'page'

    def get_paginated_response(self, data):
        return Response({
            'success': True,
            'data': {
                'count': self.page.paginator.count,
                'next': self.get_next_link(),
                'previous': self.get_previous_link(),
                'results': data
            }
        })
```

### 3. å¼‚å¸¸å¤„ç†

**æ–‡ä»¶**: `common/exceptions.py`

```python
from rest_framework.views import exception_handler
from rest_framework.exceptions import APIException
from .responses import APIResponse

def custom_exception_handler(exc, context):
    """è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†"""
    response = exception_handler(exc, context)
    
    if response is not None:
        if isinstance(exc, APIException):
            return APIResponse.error(
                message=str(exc.detail),
                code=exc.default_code.upper(),
                status_code=response.status_code
            )
    
    return response

class BusinessException(APIException):
    """ä¸šåŠ¡å¼‚å¸¸"""
    status_code = 400
    default_detail = 'ä¸šåŠ¡å¤„ç†å¤±è´¥'
    default_code = 'business_error'
```

### 4. æƒé™æ§åˆ¶

**æ–‡ä»¶**: `apps/authentication/permissions.py`

```python
from rest_framework import permissions

class IsAdminOrReadOnly(permissions.BasePermission):
    """ç®¡ç†å‘˜å¯å†™ï¼Œå…¶ä»–äººåªè¯»"""
    
    def has_permission(self, request, view):
        if request.method in permissions.SAFE_METHODS:
            return True
        return request.user and request.user.role == 'admin'

class IsManagerOrAdmin(permissions.BasePermission):
    """ä»“åº“ç®¡ç†å‘˜æˆ–ç®¡ç†å‘˜"""
    
    def has_permission(self, request, view):
        return request.user and request.user.role in ['admin', 'manager']

class IsOperatorOrAbove(permissions.BasePermission):
    """æ“ä½œå‘˜åŠä»¥ä¸Šæƒé™"""
    
    def has_permission(self, request, view):
        return request.user and request.user.role in ['admin', 'manager', 'operator']
```

### 5. åºåˆ—åŒ–å™¨ç¤ºä¾‹

**æ–‡ä»¶**: `apps/inventory/serializers.py`

```python
from rest_framework import serializers
from .models import Item, Category
from apps.suppliers.serializers import SupplierSimpleSerializer

class CategorySerializer(serializers.ModelSerializer):
    """ç±»åˆ«åºåˆ—åŒ–å™¨"""
    item_count = serializers.SerializerMethodField()
    
    class Meta:
        model = Category
        fields = ['id', 'name', 'code', 'description', 'item_count', 'created_at']
    
    def get_item_count(self, obj):
        return obj.items.count()

class ItemListSerializer(serializers.ModelSerializer):
    """ç‰©å“åˆ—è¡¨åºåˆ—åŒ–å™¨"""
    category = CategorySerializer(read_only=True)
    supplier = SupplierSimpleSerializer(read_only=True)
    total_value = serializers.DecimalField(max_digits=10, decimal_places=2, read_only=True)
    
    class Meta:
        model = Item
        fields = [
            'id', 'name', 'code', 'category', 'supplier',
            'price', 'stock', 'min_stock', 'warehouse_location',
            'status', 'image', 'total_value', 'created_at', 'updated_at'
        ]

class ItemCreateSerializer(serializers.ModelSerializer):
    """ç‰©å“åˆ›å»ºåºåˆ—åŒ–å™¨"""
    
    class Meta:
        model = Item
        fields = [
            'name', 'code', 'barcode', 'category', 'supplier',
            'warehouse', 'price', 'stock', 'min_stock',
            'warehouse_location', 'description', 'image'
        ]
    
    def validate_code(self, value):
        """éªŒè¯ç¼–ç å”¯ä¸€æ€§"""
        if Item.objects.filter(code=value).exists():
            raise serializers.ValidationError('ç‰©å“ç¼–ç å·²å­˜åœ¨')
        return value
    
    def validate_stock(self, value):
        """éªŒè¯åº“å­˜æ•°é‡"""
        if value < 0:
            raise serializers.ValidationError('åº“å­˜æ•°é‡ä¸èƒ½ä¸ºè´Ÿæ•°')
        return value
```

### 6. è§†å›¾é›†ç¤ºä¾‹

**æ–‡ä»¶**: `apps/inventory/views.py`

```python
from rest_framework import viewsets, filters, status
from rest_framework.decorators import action
from rest_framework.permissions import IsAuthenticated
from django_filters.rest_framework import DjangoFilterBackend
from common.responses import APIResponse
from common.pagination import StandardPagination
from .models import Item
from .serializers import ItemListSerializer, ItemCreateSerializer
from .filters import ItemFilter

class ItemViewSet(viewsets.ModelViewSet):
    """ç‰©å“è§†å›¾é›†"""
    queryset = Item.objects.select_related('category', 'supplier', 'warehouse').all()
    permission_classes = [IsAuthenticated]
    pagination_class = StandardPagination
    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]
    filterset_class = ItemFilter
    search_fields = ['name', 'code', 'barcode']
    ordering_fields = ['name', 'code', 'stock', 'price', 'created_at']
    ordering = ['-created_at']
    
    def get_serializer_class(self):
        if self.action in ['create', 'update', 'partial_update']:
            return ItemCreateSerializer
        return ItemListSerializer
    
    def list(self, request, *args, **kwargs):
        """è·å–ç‰©å“åˆ—è¡¨"""
        queryset = self.filter_queryset(self.get_queryset())
        return APIResponse.paginated(
            queryset,
            self.get_serializer_class(),
            request,
            message='è·å–ç‰©å“åˆ—è¡¨æˆåŠŸ'
        )
    
    def create(self, request, *args, **kwargs):
        """åˆ›å»ºç‰©å“"""
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        item = serializer.save(created_by=request.user)
        
        return APIResponse.success(
            data=ItemListSerializer(item).data,
            message='ç‰©å“åˆ›å»ºæˆåŠŸ',
            status_code=status.HTTP_201_CREATED
        )
    
    def retrieve(self, request, *args, **kwargs):
        """è·å–ç‰©å“è¯¦æƒ…"""
        instance = self.get_object()
        serializer = self.get_serializer(instance)
        return APIResponse.success(serializer.data, 'è·å–ç‰©å“è¯¦æƒ…æˆåŠŸ')
    
    def update(self, request, *args, **kwargs):
        """æ›´æ–°ç‰©å“"""
        partial = kwargs.pop('partial', False)
        instance = self.get_object()
        serializer = self.get_serializer(instance, data=request.data, partial=partial)
        serializer.is_valid(raise_exception=True)
        item = serializer.save()
        
        return APIResponse.success(
            data=ItemListSerializer(item).data,
            message='ç‰©å“æ›´æ–°æˆåŠŸ'
        )
    
    def destroy(self, request, *args, **kwargs):
        """åˆ é™¤ç‰©å“"""
        instance = self.get_object()
        instance.delete()
        return APIResponse.success(message='ç‰©å“åˆ é™¤æˆåŠŸ')
    
    @action(detail=False, methods=['get'])
    def low_stock(self, request):
        """è·å–ä½åº“å­˜ç‰©å“"""
        queryset = self.get_queryset().filter(status='low_stock')
        return APIResponse.paginated(
            queryset,
            ItemListSerializer,
            request,
            message='è·å–ä½åº“å­˜ç‰©å“æˆåŠŸ'
        )
    
    @action(detail=True, methods=['post'])
    def upload_image(self, request, pk=None):
        """ä¸Šä¼ ç‰©å“å›¾ç‰‡"""
        item = self.get_object()
        image = request.FILES.get('image')
        
        if not image:
            return APIResponse.error('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶')
        
        item.image = image
        item.save()
        
        return APIResponse.success(
            data={'url': item.image.url},
            message='å›¾ç‰‡ä¸Šä¼ æˆåŠŸ'
        )
```

### 7. è¿‡æ»¤å™¨

**æ–‡ä»¶**: `apps/inventory/filters.py`

```python
import django_filters
from .models import Item

class ItemFilter(django_filters.FilterSet):
    """ç‰©å“è¿‡æ»¤å™¨"""
    name = django_filters.CharFilter(lookup_expr='icontains')
    code = django_filters.CharFilter(lookup_expr='icontains')
    category = django_filters.NumberFilter(field_name='category__id')
    supplier = django_filters.NumberFilter(field_name='supplier__id')
    min_price = django_filters.NumberFilter(field_name='price', lookup_expr='gte')
    max_price = django_filters.NumberFilter(field_name='price', lookup_expr='lte')
    low_stock = django_filters.BooleanFilter(method='filter_low_stock')
    
    class Meta:
        model = Item
        fields = ['name', 'code', 'category', 'supplier', 'status']
    
    def filter_low_stock(self, queryset, name, value):
        if value:
            return queryset.filter(stock__lte=models.F('min_stock'))
        return queryset
```

---

## ğŸ” JWTè®¤è¯é…ç½®

**æ–‡ä»¶**: `config/settings.py`

```python
from datetime import timedelta

# JWTé…ç½®
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(hours=24),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
    'UPDATE_LAST_LOGIN': True,
    
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    'VERIFYING_KEY': None,
    
    'AUTH_HEADER_TYPES': ('Bearer',),
    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
    
    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),
    'TOKEN_TYPE_CLAIM': 'token_type',
}

# REST Frameworké…ç½®
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.IsAuthenticated',
    ),
    'DEFAULT_PAGINATION_CLASS': 'common.pagination.StandardPagination',
    'PAGE_SIZE': 20,
    'EXCEPTION_HANDLER': 'common.exceptions.custom_exception_handler',
    'DEFAULT_FILTER_BACKENDS': (
        'django_filters.rest_framework.DjangoFilterBackend',
    ),
}
```

---

## ğŸ“ ä¾èµ–æ–‡ä»¶

**æ–‡ä»¶**: `requirements.txt`

```txt
# Djangoæ ¸å¿ƒ
Django==4.2.7
djangorestframework==3.14.0

# JWTè®¤è¯
djangorestframework-simplejwt==5.3.0

# æ•°æ®åº“
psycopg2-binary==2.9.9  # PostgreSQL
mysqlclient==2.2.0      # MySQL (å¯é€‰)

# è¿‡æ»¤å’Œæœç´¢
django-filter==23.3

# å›¾ç‰‡å¤„ç†
Pillow==10.1.0

# CORSæ”¯æŒ
django-cors-headers==4.3.0

# ç¯å¢ƒå˜é‡
python-decouple==3.8

# Redisç¼“å­˜ (å¯é€‰)
redis==5.0.1
django-redis==5.4.0

# æ–‡æ¡£ç”Ÿæˆ
drf-yasg==1.21.7

# å¼€å‘å·¥å…·
django-debug-toolbar==4.2.0
ipython==8.17.2

# éƒ¨ç½²
gunicorn==21.2.0
whitenoise==6.6.0

# æµ‹è¯•
pytest==7.4.3
pytest-django==4.7.0
factory-boy==3.3.0
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒé…ç½®

**æ–‡ä»¶**: `.env`

```env
# Djangoé…ç½®
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# æ•°æ®åº“é…ç½®
DB_ENGINE=django.db.backends.sqlite3
DB_NAME=db.sqlite3
# DB_ENGINE=django.db.backends.postgresql
# DB_NAME=inventory_db
# DB_USER=postgres
# DB_PASSWORD=password
# DB_HOST=localhost
# DB_PORT=5432

# Redisé…ç½® (å¯é€‰)
REDIS_URL=redis://localhost:6379/0

# æ–‡ä»¶ä¸Šä¼ 
MEDIA_URL=/media/
MEDIA_ROOT=media/
```

### 2. åˆå§‹åŒ–å‘½ä»¤

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æ•°æ®åº“è¿ç§»
python manage.py makemigrations
python manage.py migrate

# åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser

# æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic --noinput

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python manage.py runserver
```

### 3. åˆ›å»ºæµ‹è¯•æ•°æ®

```bash
python manage.py shell

# åœ¨shellä¸­æ‰§è¡Œ
from apps.inventory.models import Category, Item
from apps.suppliers.models import Supplier

# åˆ›å»ºç±»åˆ«
category = Category.objects.create(
    name='ç”µå­è®¾å¤‡',
    code='electronics',
    description='ç”µå­äº§å“åŠé…ä»¶'
)

# åˆ›å»ºä¾›åº”å•†
supplier = Supplier.objects.create(
    name='ç§‘æŠ€é…ä»¶ä¾›åº”å•†',
    code='SUP-001',
    contact='å¼ ç»ç†',
    phone='13800138000'
)

# åˆ›å»ºç‰©å“
item = Item.objects.create(
    name='æ— çº¿é¼ æ ‡',
    code='WM-200',
    category=category,
    supplier=supplier,
    price=89.00,
    stock=150,
    min_stock=20
)
```

---

## ğŸ³ Dockeréƒ¨ç½²

**æ–‡ä»¶**: `Dockerfile`

```dockerfile
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# æ”¶é›†é™æ€æ–‡ä»¶
RUN python manage.py collectstatic --noinput

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000"]
```

**æ–‡ä»¶**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: inventory_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  web:
    build: .
    command: gunicorn config.wsgi:application --bind 0.0.0.0:8000
    volumes:
      - .:/app
      - static_volume:/app/static
      - media_volume:/app/media
    ports:
      - "8000:8000"
    env_file:
      - .env
    depends_on:
      - db
      - redis

  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - static_volume:/app/static
      - media_volume:/app/media
    ports:
      - "80:80"
    depends_on:
      - web

volumes:
  postgres_data:
  static_volume:
  media_volume:
```

---

## ğŸ“š APIæ–‡æ¡£ç”Ÿæˆ

ä½¿ç”¨ `drf-yasg` è‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£

**æ–‡ä»¶**: `config/urls.py`

```python
from django.contrib import admin
from django.urls import path, include
from rest_framework import permissions
from drf_yasg.views import get_schema_view
from drf_yasg import openapi

schema_view = get_schema_view(
    openapi.Info(
        title="åº“å­˜ç®¡ç†ç³»ç»Ÿ API",
        default_version='v1',
        description="åº“å­˜ç®¡ç†ç³»ç»Ÿåç«¯APIæ–‡æ¡£",
        contact=openapi.Contact(email="admin@example.com"),
    ),
    public=True,
    permission_classes=(permissions.AllowAny,),
)

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/auth/', include('apps.authentication.urls')),
    path('api/items/', include('apps.inventory.urls')),
    path('api/operations/', include('apps.operations.urls')),
    path('api/dashboard/', include('apps.dashboard.urls')),
    path('api/suppliers/', include('apps.suppliers.urls')),
    path('api/warehouses/', include('apps.warehouses.urls')),
    path('api/reports/', include('apps.reports.urls')),
    
    # APIæ–‡æ¡£
    path('swagger/', schema_view.with_ui('swagger', cache_timeout=0), name='schema-swagger-ui'),
    path('redoc/', schema_view.with_ui('redoc', cache_timeout=0), name='schema-redoc'),
]
```

è®¿é—® `http://localhost:8000/swagger/` æŸ¥çœ‹APIæ–‡æ¡£

---

## âœ… æµ‹è¯•

**æ–‡ä»¶**: `apps/inventory/tests.py`

```python
from django.test import TestCase
from rest_framework.test import APIClient
from rest_framework import status
from apps.authentication.models import User
from .models import Item, Category

class ItemAPITestCase(TestCase):
    def setUp(self):
        self.client = APIClient()
        self.user = User.objects.create_user(
            username='testuser',
            password='testpass123'
        )
        self.client.force_authenticate(user=self.user)
        
        self.category = Category.objects.create(
            name='æµ‹è¯•ç±»åˆ«',
            code='TEST'
        )
    
    def test_create_item(self):
        """æµ‹è¯•åˆ›å»ºç‰©å“"""
        data = {
            'name': 'æµ‹è¯•ç‰©å“',
            'code': 'TEST-001',
            'category': self.category.id,
            'price': 100.00,
            'stock': 50
        }
        response = self.client.post('/api/items/', data)
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Item.objects.count(), 1)
    
    def test_list_items(self):
        """æµ‹è¯•è·å–ç‰©å“åˆ—è¡¨"""
        response = self.client.get('/api/items/')
        self.assertEqual(response.status_code, status.HTTP_200_OK)
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
python manage.py test
# æˆ–ä½¿ç”¨pytest
pytest
```

---

## ğŸ“– å¼€å‘è§„èŒƒ

### 1. ä»£ç é£æ ¼
- éµå¾ª PEP 8
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²

### 2. Gitæäº¤è§„èŒƒ
```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·é“¾ç›¸å…³
```

### 3. åˆ†æ”¯ç®¡ç†
- `main`: ç”Ÿäº§ç¯å¢ƒ
- `develop`: å¼€å‘ç¯å¢ƒ
- `feature/*`: åŠŸèƒ½åˆ†æ”¯
- `hotfix/*`: ç´§æ€¥ä¿®å¤

---

## ğŸ” æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - ä½¿ç”¨ `select_related` å’Œ `prefetch_related`
   - æ·»åŠ é€‚å½“çš„ç´¢å¼•
   - ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 

2. **ç¼“å­˜ç­–ç•¥**
   - Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
   - ä½¿ç”¨Djangoç¼“å­˜æ¡†æ¶

3. **æŸ¥è¯¢ä¼˜åŒ–**
   - é¿å…N+1æŸ¥è¯¢
   - ä½¿ç”¨ `only()` å’Œ `defer()` é™åˆ¶å­—æ®µ

4. **å¼‚æ­¥ä»»åŠ¡**
   - ä½¿ç”¨Celeryå¤„ç†è€—æ—¶ä»»åŠ¡
   - æŠ¥è¡¨ç”Ÿæˆå¼‚æ­¥åŒ–

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…ï¼š
- Djangoå®˜æ–¹æ–‡æ¡£: https://docs.djangoproject.com/
- DRFå®˜æ–¹æ–‡æ¡£: https://www.django-rest-framework.org/
- é¡¹ç›®Wiki: (å¾…è¡¥å……)
