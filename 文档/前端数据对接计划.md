# 前端数据对接计划

## 当前问题
页面上显示的都是硬编码的假数据，需要将每个UI控件对接到真实的API。

## 需要对接的模块

### 1. 仪表盘页面 (Dashboard)

#### 统计卡片
- [x] 总物品数量 - `#total-items-count`
- [x] 低库存物品 - `#low-stock-count`
- [x] 库存总价值 - `#total-value`
- [x] 本月周转率 - `#turnover-rate`

#### 最近活动表格
- [ ] 需要添加 `id="recent-activities-tbody"` 到 tbody
- [ ] 删除硬编码的 tr 数据
- [ ] JavaScript 动态渲染

#### 低库存物品列表
- [ ] 需要添加 `id="low-stock-items"` 到容器
- [ ] 删除硬编码的物品卡片
- [ ] JavaScript 动态渲染

### 2. 库存物品页面 (Items)

#### 物品列表表格
- [x] 已有 `id="items-table-body"`
- [x] 已有加载状态
- [ ] 需要完善 JavaScript 渲染逻辑

### 3. 入库管理页面 (Inbound)

#### 入库记录表格
- [x] 已有 `id="inbound-table-body"`
- [x] 已有加载状态
- [ ] 需要添加 JavaScript 加载逻辑

### 4. 出库管理页面 (Outbound)

#### 出库记录表格
- [x] 已有 `id="outbound-table-body"`
- [x] 已有加载状态
- [ ] 需要添加 JavaScript 加载逻辑

### 5. 仓库管理页面 (Warehouse)

#### 仓库卡片
- [x] 已有 `id="warehouses-container"`
- [x] 已有加载状态
- [ ] 需要添加 JavaScript 渲染逻辑

### 6. 供应商页面 (Supplier)

#### 供应商卡片
- [x] 已有 `id="suppliers-container"`
- [x] 已有加载状态
- [ ] 需要添加 JavaScript 渲染逻辑

## 修复步骤

### 步骤1: 修复HTML - 添加ID和清空假数据

```html
<!-- 最近活动表格 -->
<tbody id="recent-activities-tbody">
  <tr>
    <td colspan="5" class="text-center py-8 text-gray-dark">
      <i class="fas fa-spinner fa-spin text-2xl mb-2"></i><br>加载中...
    </td>
  </tr>
</tbody>

<!-- 低库存物品 -->
<div id="low-stock-items" class="space-y-4">
  <div class="text-center py-8 text-gray-dark">
    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i><br>加载中...
  </div>
</div>
```

### 步骤2: 更新JavaScript - 完善数据渲染

需要更新 `app.js` 中的以下方法：

1. `DashboardController.renderActivities()` - 渲染最近活动
2. `DashboardController.renderLowStock()` - 渲染低库存物品
3. `ItemsController.renderItems()` - 渲染物品列表
4. `InboundController.renderRecords()` - 渲染入库记录
5. `OutboundController.renderRecords()` - 渲染出库记录
6. `WarehouseController.renderWarehouses()` - 渲染仓库卡片
7. `SupplierController.renderSuppliers()` - 渲染供应商卡片

### 步骤3: 复制文件到正确位置

```bash
Copy-Item "templates\static\js\app.js" -Destination "static\js\app.js" -Force
```

### 步骤4: 测试验证

1. 刷新浏览器 (Ctrl+F5)
2. 打开控制台查看数据加载日志
3. 验证每个页面的数据显示

## API数据结构

### Dashboard Overview API
```
GET /api/dashboard/overview/
Response:
{
  "success": true,
  "data": {
    "total_items": 7,
    "low_stock_items": 3,
    "total_value": 15000.00,
    "turnover_rate": 12.5
  }
}
```

### Dashboard Activities API
```
GET /api/dashboard/activities/?limit=10
Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "item_name": "无线鼠标",
      "item_code": "WM-001",
      "type": "in",
      "type_display": "入库",
      "quantity": 50,
      "operator": "张三",
      "created_at": "2025-12-06T10:30:00Z"
    }
  ]
}
```

### Dashboard Low Stock API
```
GET /api/dashboard/low-stock/
Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "笔记本电脑包",
      "code": "BAG-001",
      "stock": 5,
      "min_stock": 10,
      "image": "http://..."
    }
  ]
}
```

## 优先级

1. **高优先级** - 仪表盘统计卡片 ✅ 已完成
2. **高优先级** - 仪表盘最近活动
3. **高优先级** - 仪表盘低库存物品
4. **中优先级** - 库存物品列表
5. **中优先级** - 仓库和供应商卡片
6. **低优先级** - 入库出库记录

## 下一步行动

1. 修改HTML，给最近活动表格添加ID
2. 修改HTML，给低库存物品容器添加ID
3. 删除硬编码的假数据
4. 更新JavaScript渲染方法
5. 测试所有页面的数据加载
