# 添加物品功能实现计划

## 当前问题
- 表单输入框缺少name属性
- 没有图片上传功能
- 没有表单提交处理
- 类别和供应商是硬编码的选项

## 需要完成的工作

### 1. 修改HTML表单
- ✅ 为所有输入框添加name和id属性
- ⬜ 添加隐藏的文件上传input
- ⬜ 添加图片预览区域
- ⬜ 动态加载类别和供应商选项

### 2. JavaScript功能
- ⬜ 图片上传处理（点击/拖放）
- ⬜ 图片预览
- ⬜ 表单验证
- ⬜ 表单提交到API
- ⬜ 成功/失败提示

### 3. 后端API
- ⬜ 确认POST /api/inventory/items/ 接口存在
- ⬜ 支持multipart/form-data（图片上传）
- ⬜ 返回创建成功的物品数据

## 实现步骤

### 步骤1: 完善HTML表单

需要添加的name属性:
- name="name" - 物品名称
- name="code" - 物品编码  
- name="category" - 类别
- name="supplier" - 供应商
- name="price" - 单价
- name="stock" - 库存数量
- name="min_stock" - 最低库存
- name="warehouse" - 仓库位置
- name="description" - 描述
- name="image" - 图片文件

### 步骤2: 添加图片上传

```html
<input type="file" id="item-image-input" name="image" accept="image/*" class="hidden">
<div id="image-preview" class="hidden mt-3">
  <img id="preview-img" class="max-w-full h-32 rounded">
  <button type="button" id="remove-image">删除</button>
</div>
```

### 步骤3: JavaScript处理

```javascript
const ItemFormManager = {
  init() {
    // 绑定打开模态框
    // 绑定关闭模态框
    // 绑定图片上传
    // 绑定表单提交
  },
  
  openModal() {
    // 显示模态框
    // 加载类别和供应商
    // 重置表单
  },
  
  closeModal() {
    // 隐藏模态框
    // 清空表单
  },
  
  handleImageUpload(file) {
    // 验证文件类型和大小
    // 显示预览
  },
  
  async submitForm(formData) {
    // 调用API创建物品
    // 显示成功/失败消息
    // 刷新物品列表
  }
};
```

### 步骤4: API调用

```javascript
API.Inventory.createItem(formData)
  .then(response => {
    // 成功处理
    Utils.showSuccess('物品添加成功！');
    ItemFormManager.closeModal();
    ItemsController.loadData();
  })
  .catch(error => {
    // 错误处理
    Utils.showError('添加失败: ' + error.message);
  });
```

## 快速实现方案

由于修改较多，建议分步实现:

1. **第一步**: 先实现基本的表单提交（不含图片）
   - 添加name属性
   - 实现表单提交
   - 测试API调用

2. **第二步**: 添加图片上传功能
   - 添加文件input
   - 实现预览
   - 支持multipart上传

3. **第三步**: 优化用户体验
   - 加载动画
   - 表单验证
   - 错误提示

## 注意事项

1. 图片上传需要使用FormData
2. API可能需要支持multipart/form-data
3. 需要处理文件大小限制（5MB）
4. 需要验证图片格式（JPG, PNG）
5. 类别和供应商需要从API动态加载

## 测试步骤

1. 点击"添加物品"按钮
2. 填写所有必填字段
3. 上传图片
4. 点击"保存物品"
5. 验证物品是否添加成功
6. 验证列表是否刷新
